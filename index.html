<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Convierte n√∫meros a letras en pesos colombianos con un dise√±o moderno y elegante.">
  <title>Conversor de N√∫meros a Letras</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <button class="toggle-dark-mode" onclick="toggleDarkMode()" aria-label="Activar modo oscuro">üåô</button>

  <header>
    <h1>Conversor de N√∫meros a Letras</h1>
    <p>Convierte cifras a palabras en pesos colombianos de forma moderna y elegante.</p>
  </header>

  <main>
    <div class="container">
      <h2>Ingresa el n√∫mero</h2>
      <label for="numero">N√∫mero:</label>
      <input type="text" id="numero" placeholder="Ejemplo: 1234.56" oninput="validarNumero(event)">
      <button onclick="convertir()">Convertir</button>
      <p class="result" id="resultado"></p>

      <section class="history" id="historial" aria-label="Historial de conversiones">
        <div class="history-header">
          <h3>Historial de conversiones</h3>
          <button class="clear-history" onclick="limpiarHistorial()" aria-label="Limpiar historial">üóëÔ∏è Limpiar</button>
        </div>
        <ul id="lista-historial"></ul>
      </section>
    </div>

    <section class="info">
      <h2>¬øPor qu√© usar este conversor?</h2>
      <p>
        Esencial para documentos financieros, legales y administrativos. Nuestro conversor te garantiza:
      </p>
      <ul>
        <li><strong>Precisi√≥n:</strong> Conversi√≥n exacta respetando las normas gramaticales.</li>
        <li><strong>Facilidad de uso:</strong> Interfaz intuitiva adaptable a cualquier dispositivo.</li>
        <li><strong>Modo oscuro:</strong> Experiencia c√≥moda en entornos de baja iluminaci√≥n.</li>
        <li><strong>Historial:</strong> Acceso r√°pido a conversiones recientes.</li>
      </ul>
      <h2>¬øC√≥mo funciona?</h2>
      <p>
        Ingresa el n√∫mero, presiona "Convertir" y obt√©n la conversi√≥n a palabras al instante. El historial se actualiza
        autom√°ticamente.
      </p>
    </section>

    <section class="credits">
      <h2>Acerca de esta API</h2>
      <p>
        Esta herramienta utiliza una API desarrollada en Python y se apoya en las siguientes librer√≠as:
      </p>
      <ul>
        <li><strong>Flask:</strong> Framework web minimalista.</li>
        <li><strong>Flask-CORS:</strong> Habilita la comunicaci√≥n entre dominios.</li>
        <li><strong>num2words:</strong> Convierte n√∫meros en palabras adaptado al espa√±ol.</li>
      </ul>
      <p>
        ¬°Gracias a la comunidad de c√≥digo abierto por estas incre√≠bles herramientas!
      </p>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("dark-mode") === "enabled") {
        document.body.classList.add("dark-mode");
      }
      const historialGuardado = localStorage.getItem("conversion-history");
      if (historialGuardado) {
        document.getElementById("lista-historial").innerHTML = historialGuardado;
        document.getElementById("historial").style.display = "block";
      }
    });

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("dark-mode", document.body.classList.contains("dark-mode") ? "enabled" : "disabled");

      // Ajustar los textos din√°micos cuando cambia el modo oscuro
      const resultado = document.getElementById("resultado");
      const historial = document.getElementById("historial");

      if (document.body.classList.contains("dark-mode")) {
        resultado.style.color = "#ffffff";
        historial.style.color = "#ffffff";
      } else {
        resultado.style.color = "";
        historial.style.color = "";
      }
    }

    function validarNumero(event) {
      let input = event.target;
      let valor = input.value;
      valor = valor.replace(/[^0-9.]/g, "");
      const parts = valor.split(".");
      if (parts.length > 2) {
        valor = parts[0] + "." + parts.slice(1).join("");
      }
      input.value = valor;
    }

    async function convertir() {
      const input = document.getElementById("numero");
      const numero = input.value.trim();
      const resultado = document.getElementById("resultado");
      const historial = document.getElementById("historial");
      const listaHistorial = document.getElementById("lista-historial");

      if (numero === "" || isNaN(parseFloat(numero))) {
        alert("Por favor, ingrese un n√∫mero v√°lido.");
        return;
      }

      resultado.textContent = "Convirtiendo...";
      resultado.classList.remove("visible");

      try {
        const response = await fetch(`https://num2let.onrender.com/convert?number=${encodeURIComponent(numero)}`);
        if (!response.ok) {
          throw new Error("Error en la respuesta de la API");
        }
        const data = await response.json();
        if (data.texto) {
          resultado.textContent = data.texto;
          resultado.classList.add("visible");

          const nuevoItem = document.createElement("li");
          nuevoItem.textContent = `${numero} ‚Üí ${data.texto}`;
          listaHistorial.prepend(nuevoItem);
          historial.style.display = "block";
          localStorage.setItem("conversion-history", listaHistorial.innerHTML);

          if (listaHistorial.children.length > 5) {
            listaHistorial.removeChild(listaHistorial.lastChild);
            localStorage.setItem("conversion-history", listaHistorial.innerHTML);
          }
        } else {
          resultado.textContent = "Error en la conversi√≥n.";
        }
      } catch (error) {
        console.error("Error en la solicitud:", error);
        resultado.textContent = "Error al conectar con la API.";
      }
    }

    function limpiarHistorial() {
      const listaHistorial = document.getElementById("lista-historial");
      listaHistorial.innerHTML = "";
      document.getElementById("historial").style.display = "none";
      localStorage.removeItem("conversion-history");
    }
  </script>
</body>

</html>